
{% extends "base.html" %}

{% block content %}
<div class="py-5 text-center">
    <h2>Welcome to the Psychologist Journal</h2>
    <p class="lead">This is a secure platform for psychologists to manage their patients.</p>
</div>
<div>
    <div id="calendar"></div>
</div>
<!-- Inkluder modalen her -->
{% include 'appointment_modal.html' %}
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
      var calendarEl = document.getElementById('calendar');
    
      var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        events: '/get_appointments', // Endepunkt for å hente avtaler
        dateClick: function(info) {
          // Åpne modalen for å legge til en avtale
          $('#appointmentDate').val(info.dateStr);
          $('#appointmentModal').modal('show');
        }
      });
    
      calendar.render();
    });
    </script>
    <script>
      $(document).ready(function() {
        // Når modalen åpnes
        $('#appointmentModal').on('show.bs.modal', function () {
          // Fjern tidligere pasientvalg
          $('#appointmentPatient').empty();
      
          // Hent pasientliste fra serveren
          $.getJSON('/get_patients', function(data) {
            // Sjekk om det er pasienter å vise
            if(data.length > 0) {
              data.forEach(function(patient) {
                // Legg til hver pasient som et valg
                $('#appointmentPatient').append(new Option(patient.full_name, patient.id));
              });
            } else {
              // Ingen pasienter funnet
              $('#appointmentPatient').append(new Option('Ingen pasienter funnet', ''));
            }
          });
        });
      
        // Håndter innsending av skjemaet
        $('#appointmentForm').on('submit', function(e) {
          e.preventDefault(); // Forhindre standard skjemainnsending
      
          // Samle data fra skjemaet
          var appointmentData = {
            datetime: $('#appointmentDate').val(),
            description: $('#appointmentDescription').val(),
            patient_id: $('#appointmentPatient').val() // Inkluder valgt pasient-ID
          };
      
          // Send data til serveren
          $.post('/add_appointment', appointmentData, function() {
            $('#appointmentModal').modal('hide'); // Lukk modalen
            // Oppdater kalenderen eller utfør andre handlinger etter behov
          });
        });
      });
      </script>
      
        
    
{% endblock %}
